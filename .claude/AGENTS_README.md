# Claude Code カスタムエージェント - 使い方ガイド

## 概要
このプロジェクトでは、要件定義、コードレビュー、テスト計画のための専門的なカスタムエージェントを用意しています。

## 利用可能なエージェント

### 1. **Requirements Analyst** (`requirements-analyst`)
要件定義と仕様策定の専門家

**得意分野:**
- ステークホルダーへのヒアリングと要件抽出
- 機能要件・非機能要件の整理
- ユーザーストーリー・ユースケースの作成
- 受入基準の定義（Given-When-Then形式）
- 優先順位付け（MoSCoW法）
- 要件定義書・仕様書の作成
- インタラクティブな質問による要件の明確化

**使用タイミング:**
- 新機能を追加する前に要件を整理したい時
- ユーザーの要望を具体的な仕様に落とし込みたい時
- 開発チームに実装可能な形で要件を伝えたい時
- 機能の優先順位を決めたい時
- 受入基準やテストシナリオを定義したい時

**特徴:**
- `AskUserQuestion` ツールを活用してインタラクティブにヒアリング
- 曖昧な要件を具体的な仕様に変換
- 段階的な実装計画（MVP → Phase 2 → Phase 3）を提案

### 2. **Test Planner** (`planner-test`)
テスト戦略とテストケース設計の専門家

**得意分野:**
- コードベースの分析とテスト対象の特定
- ユニット・統合・E2Eテストの計画立案
- テストケースの優先順位付け
- テストカバレッジ目標の設定
- 具体的なテストコード例の提供

**使用タイミング:**
- 新機能のテストを計画する時
- テストカバレッジを向上させたい時
- テスト戦略を見直したい時
- E2Eテストのシナリオを設計する時

### 3. **Backend Reviewer** (`reviewer-backend`)
バックエンドコードレビュー専門家

**得意分野:**
- API設計とRoute Handlers
- ビジネスロジック
- データベース操作
- エラーハンドリング

### 4. **DevOps Reviewer** (`reviewer-devops`)
DevOps とインフラストラクチャレビュー専門家

**得意分野:**
- CI/CD パイプライン
- デプロイ設定
- 監視とロギング
- Docker/コンテナ設定

### 5. **Frontend Reviewer** (`reviewer-frontend`)
React/Next.js のコードレビュー専門家

**得意分野:**
- Server Components vs Client Components
- パフォーマンス最適化
- アクセシビリティ (a11y)
- UX/デザインパターン
- TypeScript フロントエンド

### 6. **Performance Reviewer** (`reviewer-performance`)
パフォーマンス最適化専門家

**得意分野:**
- アルゴリズム最適化
- レンダリングパフォーマンス
- キャッシュ戦略
- バンドルサイズ最適化

### 7. **Security Reviewer** (`reviewer-security`)
セキュリティレビュー専門家

**得意分野:**
- OWASP Top 10
- 認証・認可
- インジェクション攻撃対策
- データ検証

## 使い方

### 方法1: 明示的な呼び出し

エージェント名を `@` で指定して呼び出します：

```
@planner-test
app/equipment/ 配下のコンポーネントのテストプランを作成してください
```

```
@reviewer-frontend
このコンポーネントをレビューしてください
app/components/EquipmentTable.tsx
```

```
@reviewer-security
認証周りのセキュリティをチェックしてください
```

### 方法2: 自動委譲（推奨）

Claude Codeが自動的に最適なエージェントを選択します。普通にリクエストするだけでOK：

```
通知機能の要件を整理してください
→ 自動的に requirements-analyst が選択される

備品管理システムのテスト計画を立ててください
→ 自動的に planner-test が選択される

このReactコンポーネントをレビューしてください
→ 自動的に reviewer-frontend が選択される

セキュリティの脆弱性をチェックしてください
→ 自動的に reviewer-security が選択される
```

### 方法3: エージェント一覧から選択

```
/agents
```

利用可能なエージェント一覧が表示され、インタラクティブに選択できます。

## Requirements Analyst の具体的な使用例

### 例1: 新機能の要件定義

```
@requirements-analyst
備品の予約機能を追加したいです。要件定義書を作成してください。
現在は先着順で貸出していますが、事前に予約できるようにしたいです。
```

**出力例:**
- 機能概要と背景
- ユーザーストーリー（As a / I want to / So that 形式）
- 詳細なユースケース（正常フロー・例外フロー）
- 画面要件（ワイヤーフレーム付き）
- データ要件（データモデル・バリデーション）
- ビジネスルール
- 受入基準（Given-When-Then形式）
- 優先順位（MoSCoW法）
- 実装スケジュール（Phase別）

### 例2: 曖昧な要望の具体化

```
@requirements-analyst
システムをもっと使いやすくしたいです。要件を整理してください。
```

**エージェントの動作:**
1. `AskUserQuestion` で具体的なペインポイントをヒアリング
   - 「どの機能が使いにくいですか？」
   - 「どのような場面で困っていますか？」
   - 「理想的な操作はどのようなものですか？」
2. 回答を基に具体的な改善要件を作成
3. 優先順位をつけて段階的な実装計画を提案

**出力例:**
- 現状の課題整理
- 改善すべき項目のリスト（優先度付き）
- 各改善項目の詳細仕様
- Before/After の比較
- 受入基準

### 例3: 非機能要件の定義

```
@requirements-analyst
パフォーマンス要件とセキュリティ要件を定義してください。
このシステムは50人の社員が使います。
```

**出力例:**
- パフォーマンス要件（応答時間、同時接続数など）
- セキュリティ要件（認証、認可、暗号化など）
- 可用性要件（稼働率、バックアップ）
- ユーザビリティ要件（アクセシビリティ）
- 互換性要件（ブラウザ、デバイス）
- 各要件の測定方法と受入基準

## Test Planner の具体的な使用例

### 例1: 新機能のテスト計画

```
@planner-test
備品貸出機能（app/loans/）のテストプランを作成してください。
ユニットテスト、統合テスト、E2Eテストの観点から包括的な計画をお願いします。
```

**出力例:**
- 優先順位付けされたテスト対象リスト
- 各テストケースの詳細設計
- テストコードのサンプル
- 実装スケジュール
- カバレッジ目標

### 例2: 既存コードのテストカバレッジ向上

```
@planner-test
lib/services/ 配下のビジネスロジックを分析して、
テストカバレッジを80%以上にするための計画を立ててください。
```

**出力例:**
- 現状のテスト状況分析
- テストが不足している箇所の特定
- 優先的にテストすべき関数のリスト
- 具体的なテストケース例

### 例3: E2Eテストシナリオの設計

```
@planner-test
備品管理システムのクリティカルパスを特定して、
Playwrightを使ったE2Eテストシナリオを設計してください。
```

**出力例:**
- ユーザーストーリーベースのシナリオ
- Playwright テストコード例
- テストデータのセットアップ方法
- CIでの実行設定

## エージェントのカスタマイズ

### エージェントファイルの編集

エージェント定義ファイルは `.claude/agents/` にあります：

```
.claude/agents/
├── planner-test.md           # テストプランナー
├── reviewer-backend.md       # バックエンドレビュー
├── reviewer-devops.md        # DevOpsレビュー
├── reviewer-frontend.md      # フロントエンドレビュー
├── reviewer-performance.md   # パフォーマンスレビュー
└── reviewer-security.md      # セキュリティレビュー
```

各ファイルはMarkdown形式で、YAML frontmatter を含みます：

```markdown
---
name: agent-name
description: エージェントの説明
tools: Read, Grep, Glob, Bash
model: sonnet
---

# エージェントのシステムプロンプト

ここに詳細な指示を記述...
```

### プロジェクト固有のカスタマイズ

エージェントファイルを編集して、プロジェクト固有の要件を追加できます：

```markdown
## プロジェクト固有の観点

### 会社備品管理システムでの注意点
- 備品の在庫管理ロジックは必ずテスト必須
- ユーザーの貸出履歴は個人情報なのでセキュリティ重視
- ...
```

## ベストプラクティス

### 1. 明確な指示を与える

**Good:**
```
@test-planner
app/equipment/page.tsx のテストプランを作成してください。
特にデータフェッチングとエラーハンドリングのテストを重視してください。
```

**Bad:**
```
テストを書いて
```

### 2. コンテキストを提供する

エージェントにファイルパスや具体的な機能名を伝えることで、より的確な提案が得られます：

```
@test-planner
以下のファイルのテスト計画をお願いします：
- lib/services/equipment-service.ts
- lib/services/loan-service.ts
- lib/validations/equipment-schema.ts

現在のテストカバレッジは30%で、70%を目指しています。
```

### 3. 段階的なアプローチ

大きなプロジェクトの場合は、機能ごとに分割してエージェントを使用：

```
# Step 1: 認証機能のテスト計画
@planner-test
認証機能（app/api/auth/）のテスト計画を立ててください

# Step 2: 備品管理機能のテスト計画
@planner-test
備品管理機能（app/equipment/）のテスト計画を立ててください

# Step 3: 統合して全体のテスト戦略を調整
@planner-test
これまでの計画を統合して、全体のテスト戦略を最適化してください
```

## トラブルシューティング

### エージェントが見つからない

```bash
# エージェントファイルの存在確認
ls -la .claude/agents/

# ファイル名とname属性が一致しているか確認
cat .claude/agents/planner-test.md | head -n 10
```

### エージェントが期待通りに動作しない

1. **description を確認**: 自動委譲が機能するためには、詳細な説明が必要
2. **tools を確認**: 必要なツールが指定されているか
3. **model を確認**: 複雑な分析には `sonnet` 以上を推奨

### カスタマイズが反映されない

エージェントファイルを編集した後は、Claude Codeを再起動するか、新しいセッションを開始してください。

## 参考リンク

- [Claude Code Agents Documentation](https://code.claude.com/docs/en/sub-agents.md)
- [プロジェクトメモリ](.claude/CLAUDE.md)
- [Hooks設定](.claude/HOOKS_README.md)

## フィードバック

エージェントの改善提案やバグ報告は、プロジェクトのIssueまたはプルリクエストで受け付けています。

## エージェント一覧（アルファベット順）

現在利用可能なエージェント：
```
.claude/agents/
├── planner-test.md           # テスト計画
├── requirements-analyst.md   # 要件定義・仕様策定
├── reviewer-backend.md       # バックエンドレビュー
├── reviewer-devops.md        # DevOps/インフラレビュー
├── reviewer-frontend.md      # フロントエンドレビュー
├── reviewer-performance.md   # パフォーマンスレビュー
└── reviewer-security.md      # セキュリティレビュー
```

カテゴリ優先の命名規則により、関連するエージェントがグループ化されます。

---

**Happy Requirements Engineering & Testing!** 🧪📋
